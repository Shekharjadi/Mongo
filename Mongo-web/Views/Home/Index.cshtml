@using Mongo_web.Models
@model GitleaksViewModel

@{
    ViewData["Title"] = "Gitleaks Results";
}

<h2>@ViewData["Title"]</h2>

<div class="container">
    <!-- Search Bar -->
    <form method="get" class="mb-4">
        <input type="text" name="searchQuery" value="@Model.SearchQuery" placeholder="Search..." class="form-control" />
        <button type="submit" class="btn btn-primary mt-2">Search</button>
    </form>

    <!-- Sorting Options -->
    <div class="mb-3">
        <strong>Sort By: </strong>
        <a href="@Url.Action("Index", new { page = 1, sortBy = "File", searchQuery = Model.SearchQuery })">File</a> |
        <a href="@Url.Action("Index", new { page = 1, sortBy = "Commit", searchQuery = Model.SearchQuery })">Commit</a> |
        <a href="@Url.Action("Index", new { page = 1, sortBy = "Secret", searchQuery = Model.SearchQuery })">Secret</a> |
        <a href="@Url.Action("Index", new { page = 1, sortBy = "Link", searchQuery = Model.SearchQuery })">Link</a>
    </div>

    
    @if (Model.Results != null && Model.Results.Any())
    {
        <!-- Table to display Gitleaks Results -->
        <table class="table table-bordered table-sm">
            <thead>
                <tr>
                    <th class="col-8 col-md-2">File Path</th>
                    <th class="col-8 col-md-3">Commit</th>
                    <th class="col-8 col-md-2">Secret</th>
                    <th class="col-8 col-md-2">Link</th>
                    <th class="col-8 col-md-2 text-center">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var result in Model.Results)
                {
                    <tr>
                        <td class="col-8 col-md-2 text-wrap">@result.File</td>
                        <td class="col-8 col-md-3 text-wrap">@result.Commit</td>
                        <td class="col-8 col-md-2 text-wrap">@result.Secret</td>
                        <td class="col-8 col-md-2">
                            <a href="@result.Link" target="_blank">Redirect To GitHubPath</a>
                        </td>
                        <td class="col-12 col-md-2 text-center">
                            <a href="@Url.Action("OpenFile", "Home", new { filePath = result.File })" class="btn btn-info btn-sm" target="_blank">Go to File</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="d-flex justify-content-between">
            <div>
                Page @Model.CurrentPage of @((Model.TotalResults + Model.PageSize - 1) / Model.PageSize)
            </div>

            <div>
                <a href="@Url.Action("Index", new { page = Model.CurrentPage - 1, sortBy = Model.SortBy, searchQuery = Model.SearchQuery })" class="btn btn-secondary btn-sm" @(Model.CurrentPage <= 1 ? "disabled" : "")>Previous</a>
                <a href="@Url.Action("Index", new { page = Model.CurrentPage + 1, sortBy = Model.SortBy, searchQuery = Model.SearchQuery })" class="btn btn-secondary btn-sm" @(Model.CurrentPage >= (Model.TotalResults + Model.PageSize - 1) / Model.PageSize ? "disabled" : "")>Next</a>
            </div>
        </div>
    }
    else
    {
        <!-- If no results or data is empty -->
        <table class="table table-bordered table-sm">
            <thead>
                <tr>
                    <th class="col-8 col-md-2">File</th>
                    <th class="col-8 col-md-3">Commit</th>
                    <th class="col-8 col-md-2">Secret</th>
                    <th class="col-8 col-md-2">Link</th>
                    <th class="col-8 col-md-2 text-center">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="5" class="text-center">No data found</td>
                </tr>
            </tbody>
        </table>
    }
</div>

<style>
    /* Table Styling */
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        padding: 10px;
        text-align: left;
    }

    th {
        font-weight: bold;
        background-color: #007bff; /* Blue background for header */
    }

    td {
        font-size: 0.85rem;
        word-wrap: break-word; /* Enable word wrapping inside cells */
    }

    /* Zebra Stripes for Table Rows (Alternating Background) */
    tr:nth-child(even) {
    }

    /* Button Styling */
    .btn-info {
        padding: 0.25rem 0.75rem;
        font-size: 0.85rem;
    }

    /* Link Styling */
    a {
        color: #007bff;
        text-decoration: none;
    }

        a:hover {
            text-decoration: underline;
        }

    /* Max width to control the column size */
    .col-md-2 {
        max-width: 150px; /* Set the maximum width of columns like File, Commit, Secret */
    }

    .col-md-3 {
        max-width: 200px; /* Set max width for columns like Commit, Link */
    }

    /* Ensure the text wraps within smaller columns */
    .text-wrap {
        word-wrap: break-word; /* Prevent overflow and wrap long text */
        overflow-wrap: break-word; /* Add support for other browsers */
    }
</style>
